from preprocess import Preprocess
from feature_selection import FeatureSelection
from vectorization import Vectorization
from preprocess import preprocess_helper
from vectorization import vectorization_helper

###
# TODO: reorganize the code below
import os
from multiprocessing import Pool, cpu_count
dataset_dir_path = './dataset/data'
NUM_CPU = cpu_count()
file_list = os.listdir(dataset_dir_path)
###

if __name__ == "__main__":

    # preprocess: disassemble and save in json and csv files
    # TODO: test if there are malwares and benign wares, the function is still right
    # TODO: renew the progress bar
    # TODO: from the base class:malware_detector: make it could be reused in its child class preprocess and feature_selection
    POOL = Pool(NUM_CPU)
    for i in file_list:
        input_pool = []
        for j in range(NUM_CPU):
            input_pool.append(i)
        POOL.map(preprocess_helper, input_pool)
    # feature selection
    ff = FeatureSelection()
    ff.func_helper()
    # vectorization
    for i in file_list:
        input_pool = []
        for j in range(NUM_CPU):
            input_pool.append(i)
        POOL.map(vectorization_helper, input_pool)

